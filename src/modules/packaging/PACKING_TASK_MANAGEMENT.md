# Управление заданиями упаковки

## Описание

Модуль `PackingTaskManagementService` и `PackingTaskManagementController` предназначен для управления заданиями упаковки. Он предоставляет функциональность для работы с уже созданными заданиями.

## Основные функции

### 1. Отметить задание как взято в работу
- **Endpoint**: `PUT /packing-task-management/:taskId/start`
- **Описание**: Переводит задание из статуса `PENDING` в `IN_PROGRESS`
- **Ограничения**: Задание должно иметь статус `PENDING`

### 2. Отметить задание как выполнено
- **Endpoint**: `PUT /packing-task-management/:taskId/complete`
- **Описание**: Переводит задание в статус `COMPLETED` и устанавливает время завершения
- **Ограничения**: Нельзя завершить уже завершенное задание

### 3. Удалить задание у станка
- **Endpoint**: `DELETE /packing-task-management/:taskId`
- **Описание**: Полностью удаляет задание из системы
- **Ограничения**: Нельзя удалить завершенное задание

### 4. Переместить задание на другой станок
- **Endpoint**: `PUT /packing-task-management/:taskId/move`
- **Описание**: Перемещает задание на другой станок, может также переназначить пользователя
- **Параметры**:
  - `newMachineId` (обязательный): ID нового станка
  - `assignedTo` (опциональный): ID пользователя для переназначения
- **Ограничения**: Нельзя перемещать завершенные задания
- **Поведение**: При перемещении статус сбрасывается на `PENDING`

### 5. Обновить статус задания
- **Endpoint**: `PUT /packing-task-management/:taskId/status`
- **Описание**: Обновляет статус задания
- **Параметры**:
  - `status`: Новый статус задания
- **Поведение**: Автоматически управляет временем завершения

### 6. Назначить пользователя на задание
- **Endpoint**: `PUT /packing-task-management/:taskId/assign`
- **Описание**: Назначает или переназначает пользователя на задание
- **Параметры**:
  - `assignedTo` (опциональный): ID пользователя или null для снятия назначения

### 7. Получить задания по пользователю
- **Endpoint**: `GET /packing-task-management/user/:userId`
- **Описание**: Возвращает все задания, назначенные конкретному пользователю
- **Сортировка**: По приоритету (убывание), затем по времени назначения (возрастание)

## Автоматическое обновление статуса упаковки

Все операции автоматически обновляют статус связанной упаковки (`Package.packingStatus`) на ос��ове статусов всех связанных заданий:

- `NOT_PROCESSED`: Нет заданий
- `PENDING`: Есть задания в статусе `PENDING`
- `IN_PROGRESS`: Есть задания в статусе `IN_PROGRESS`
- `COMPLETED`: Все задания в статусе `COMPLETED`

## Отличия от PackingAssignmentService

- `PackingAssignmentService`: Создание и назначение заданий на станки
- `PackingTaskManagementService`: Управление уже созданными заданиями (выполнение, перемещение, удаление)

## Примеры использования

### Взять задание в работу
```http
PUT /packing-task-management/123/start
```

### Завершить задание
```http
PUT /packing-task-management/123/complete
```

### Переместить задание на другой станок
```http
PUT /packing-task-management/123/move
Content-Type: application/json

{
  "newMachineId": 456,
  "assignedTo": 789
}
```

### Получить задания пользователя
```http
GET /packing-task-management/user/789
```