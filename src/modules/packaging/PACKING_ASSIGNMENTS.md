# Модуль назначения заданий на станок упаковки

Этот модуль предоставляет функциональность для управления назначением заданий упаковки на станки. Мастер упаковки может выдавать задания на станки упаковки, отслеживать их выполнение и управлять приоритетами.

## Основные возможности

- Создание заданий упаковки на конкретные станки
- Назначение заданий конкретным пользователям
- Управление статусами заданий
- Установка приоритетов заданий
- Фильтрация и поиск заданий
- Получение заданий по станку или пользователю

## API Эндпоинты

### POST /packing-assignments
Создание нового назначения задания на станок упаковки.

**Тело запроса:**
```json
{
  "packageId": 1,
  "machineId": 2,
  "assignedTo": 3,  // опционально
  "priority": 5     // опционально, по умолчанию 0
}
```

### GET /packing-assignments
Получение списка заданий с фильтрами и пагинацией.

**Параметры запроса:**
- `machineId` - фильтр по станку
- `assignedTo` - фильтр по назначенному пользователю
- `status` - фильтр по статусу (NOT_PROCESSED, PENDING, IN_PROGRESS, COMPLETED, PARTIALLY_COMPLETED)
- `page` - номер страницы (по умолчанию 1)
- `limit` - количество записей на странице (по умолчанию 10)

### GET /packing-assignments/:taskId
Получение конкретного задания по ID.

### PUT /packing-assignments/:taskId
Обновление задания (изменение статуса, переназначение пользователя).

**Тело запроса:**
```json
{
  "status": "IN_PROGRESS",
  "assignedTo": 4  // опциональн��
}
```

### DELETE /packing-assignments/:taskId
Удаление задания (только если оно не выполнено).

### GET /packing-assignments/by-machine/:machineId
Получение всех заданий для конкретного станка.

### GET /packing-assignments/by-user/:userId
Получение всех заданий для конкретного пользователя.

## Статусы заданий

- `NOT_PROCESSED` - Задача поставлена в очередь, но не обрабатывается
- `PENDING` - Ждёт начала упаковки
- `IN_PROGRESS` - Упаковка в процессе
- `COMPLETED` - Полностью упаковано
- `PARTIALLY_COMPLETED` - Упаковка завершена частично

## Структура ответа

```json
{
  "taskId": 1,
  "packageId": 1,
  "machineId": 2,
  "assignedTo": 3,
  "status": "PENDING",
  "priority": 5,
  "assignedAt": "2024-01-15T10:00:00Z",
  "completedAt": null,
  "package": {
    "packageId": 1,
    "packageName": "Упаковка А",
    "status": "PENDING"
  },
  "machine": {
    "machineId": 2,
    "machineName": "Станок упаковки №2",
    "status": "ACTIVE"
  },
  "assignedUser": {
    "userId": 3,
    "login": "operator1",
    "firstName": "Иван",
    "lastName": "Петров"
  }
}
```

## Бизнес-логика

1. **Создание задания**: При создании задания проверяется существование упаковочного пакета, станка и пользователя (если указан). Также проверяется, что для данного пакета на данном станке нет активных заданий.

2. **Приоритеты**: Задания сортируются по приоритету (высокий приоритет первым), затем по времени назначения.

3. **Статусы**: При изменении статуса на COMPLETED автоматически устанавливается время завершения.

4. **Удаление**: Можно удалять только незавершенные задания.

## Интеграция с другими модулями

- **Модуль пользователей**: Для назначения заданий пользователям
- **Модуль станков**: Для назначения заданий на конкретные станки
- **Модуль упаковки**: Для работы с упаковочными пакетами
- **WebSocket модуль**: Для уведомлений о изме��ениях в реальном времени

## Примеры использования

### Создание задания
```bash
curl -X POST http://localhost:3000/packing-assignments \
  -H "Content-Type: application/json" \
  -d '{
    "packageId": 1,
    "machineId": 2,
    "assignedTo": 3,
    "priority": 10
  }'
```

### Получение заданий для станка
```bash
curl http://localhost:3000/packing-assignments/by-machine/2
```

### Обновление статуса задания
```bash
curl -X PUT http://localhost:3000/packing-assignments/1 \
  -H "Content-Type: application/json" \
  -d '{
    "status": "IN_PROGRESS"
  }'
```