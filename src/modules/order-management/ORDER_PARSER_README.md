# Парсер для создания заказов из Excel файлов

## Описание

Модуль позволяет создавать заказы путем загрузки Excel файлов с упаковками. Система автоматически парсит файл, проверяет наличие упаковок в базе данных и создает заказ.

## Структура Excel файла

Файл должен содержать следующие колонки (могут находиться в строках 1-40):

- **Код** или **Артикул** - код упаковки
- **Наименование** или **Наименование номенклатуры** - название упаковки
- **Кол-во** или **Количество** - количество упаковок

Колонки могут располагаться не подряд (через 1-2 колонки).

## API Endpoints

### 1. Загрузка и парсинг файла

**POST** `/order-management/upload`

**Content-Type:** `multipart/form-data`

**Параметры:**
- `file` - Excel файл (.xls или .xlsx)

**Ответ:**
```json
{
  "message": "Файл успешно обработан. Все упаковки найдены в базе.",
  "filename": "order.xlsx",
  "data": {
    "packages": [
      {
        "code": "PKG001",
        "name": "Упаковка 1",
        "quantity": 10,
        "exists": true,
        "existingPackage": {
          "packageId": 1,
          "packageCode": "PKG001",
          "packageName": "Упаковка 1"
        }
      }
    ],
    "missingPackages": [],
    "allExist": true
  }
}
```

Если упаковки не найдены:
```json
{
  "message": "Файл обработан. Не найдены упаковки: PKG999",
  "filename": "order.xlsx",
  "data": {
    "packages": [...],
    "missingPackages": ["PKG999"],
    "allExist": false
  }
}
```

### 2. Сохранение заказа

**POST** `/order-management/save-from-file`

**Content-Type:** `application/json`

**Body:**
```json
{
  "batchNumber": "BATCH-2024-001",
  "orderName": "Заказ январь 2024",
  "requiredDate": "2024-12-31T00:00:00.000Z",
  "packages": [
    {
      "code": "PKG001",
      "name": "Упаковка 1",
      "quantity": 10
    },
    {
      "code": "PKG002",
      "name": "Упаковка 2",
      "quantity": 5
    }
  ]
}
```

**Ответ:**
```json
{
  "message": "Заказ успешно создан",
  "orderId": 123,
  "batchNumber": "BATCH-2024-001",
  "packagesCount": 2
}
```

**Ошибка (упаковки не найдены):**
```json
{
  "statusCode": 400,
  "message": "Следующие упаковки не найдены в базе: PKG999, PKG888"
}
```

## Процесс работы

1. **Фронтенд загружает Excel файл** через `/order-management/upload`
2. **Система парсит файл** и находит колонки с кодом, наименованием и количеством
3. **Проверяется наличие упаковок** в справочнике `PackageDirectory`
4. **Возвращается результат** с информацией о найденных/ненайденных упаковках
5. **Пользователь может изменить данные** вручную на фронтенде
6. **Фронтенд отправляет данные** через `/order-management/save-from-file` с номером партии, названием и датой
7. **Система создает заказ** с проверкой наличия всех упаковок

## Особенности

- Файл не сохраняется после парсинга (удаляется автоматически)
- Колонки могут находиться в любом порядке и через промежутки
- Заголовки ищутся в первых 40 строках файла
- Поддерживаются альтернативные названия колонок
- Количество может быть с запятой или точкой (автоматически конвертируется)
- При сохранении повторно проверяется наличие всех упаковок
- Создается состав упаковок на основе справочника деталей
