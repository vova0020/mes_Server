# Документация базы данных производственной системы

## Содержание
1. [Общий обзор](#общий-обзор)
2. [Модуль авторизации](#модуль-авторизации)
3. [Блок заказов и производства](#блок-заказов-и-производства)
4. [Модуль буферной системы](#модуль-буферной-системы)
5. [Модуль производственных процессов](#модуль-производственных-процессов)
6. [Модуль маршрутов обработки](#модуль-маршрутов-обработки)
7. [Модуль производственных линий и участков](#модуль-производственных-линий-и-участков)
8. [Фиксация данных на разных этапах](#фиксация-данных-на-разных-этапах)

## Общий обзор

База данных представляет собой комплексную систему управления производственным процессом, включающую следующие основные модули:
- Авторизация и управление пользователями
- Управление заказами и деталями
- Буферная система для временного хранения
- Производственные процессы и операции
- Маршруты обработки деталей
- Организация производственных линий и участков

## Модуль авторизации

### Таблицы и данные
- **User**: Пользователи системы
  - `id`, `username`, `password`, `roleId`, `createdAt`, `updatedAt`
- **Role**: Роли пользователей (администратор, оператор, мастер)
  - `id`, `name`, `createdAt`, `updatedAt`
- **UserDetail**: Дополнительная информация о пользователях
  - `id`, `userId`, `fullName`, `phone`, `position`, `salary`, `createdAt`, `updatedAt`
- **LoginLog**: Журнал входов в систему
  - `id`, `userId`, `loginAt`, `ip`, `userAgent`, `success`

### Фиксируемые данные
- Регистрация пользователей с назначением ролей
- Личные данные сотрудников (ФИО, телефон, должность, зарплата)
- Каждый вход в систему (успешный или неудачный)
- Информация об устройстве и IP-адресе при входе

## Блок заказов и производства

### Таблицы и данные
- **ProductionOrder**: Производственные заказы
  - `id`, `runNumber`, `name`, `progress`, `createdAt`, `finishedAt`, `allowedToRun`, `completed`
- **ProductionYpak**: УПАКи (упаковки) в составе заказов
  - `id`, `name`, `progress`, `orderId`
- **ProductionDetail**: Детали
  - `id`, `article`, `name`, `material`, `size`, `totalNumber`, `routeId`
- **ProductionYpakDetail**: Связь между УПАКами и деталями
  - `id`, `ypakId`, `detailId`, `quantity`
- **ProductionPallets**: Поддоны с деталями
  - `id`, `name`, `quantity`, `detailId`, `bufferCellId`

### Фиксируемые данные
- Создание производственных заказов с уникальными номерами партий
- Формирование УПАКов в составе заказов
- Спецификация деталей (артикул, название, материал, размеры)
- Количество деталей каждого типа в УПАКе
- Размещение деталей на поддонах с указанием количества
- Прогресс выполнения заказов и УПАКов (в процентах)
- Статусы заказов (разрешен к запуску, завершен)
- Даты создания и завершения заказов

## Модуль буферной системы

### Таблицы и данные
- **Buffer**: Буферы для временного хранения
  - `id`, `name`, `description`, `location`, `createdAt`, `updatedAt`
- **BufferCell**: Ячейки буферов
  - `id`, `code`, `bufferId`, `status`, `capacity`, `createdAt`, `updatedAt`

### Фиксируемые данные
- Создание буферов с описанием и местоположением
- Формирование ячеек в буферах с уникальными кодами
- Статусы ячеек (доступна, занята, зарезервирована, на обслуживании)
- Вместимость ячеек (количество поддонов)
- Размещение поддонов в ячейках буфера (через связь в ProductionPallets)

## Модуль производственных процессов

### Таблицы и данные
- **ProcessStep**: Этапы производственного процесса
  - `id`, `name`, `sequence`, `description`, `createdAt`, `updatedAt`
- **Machine**: Станки
  - `id`, `name`, `status`, `createdAt`, `updatedAt`, `segmentId`
- **DetailOperation**: Операции над поддонами с деталями
  - `id`, `productionPalletId`, `processStepId`, `machineId`, `operatorId`, `masterId`, `status`, `startedAt`, `completedAt`, `quantity`

### Фиксируемые данные
- Определение этапов производственного процесса с последовательностью
- Регистрация станков и их текущих статусов
- Фиксация каждой операции обработки поддона:
  - Какой поддон обрабатывается
  - На каком этапе процесса
  - На каком станке
  - Кто оператор и мастер
  - Статус операции (в процессе, завершена, в буфере)
  - Время начала и завершения операции
  - Количество обработанных деталей

## Модуль маршрутов обработки

### Таблицы и данные
- **ProductionRoute**: Маршруты обработки деталей
  - `id`, `name`
- **RouteStep**: Этапы в маршруте
  - `id`, `routeId`, `processStepId`, `sequence`

### Фиксируемые данные
- Создание именованных маршрутов обработки
- Определение последовательности этапов для каждого маршрута
- Привязка маршрутов к конкретным деталям (через связь в ProductionDetail)

## Модуль производственных линий и участков

### Таблицы и данные
- **ProductionLine**: Производственные линии
  - `id`, `name`, `type`, `defaultBufferId`, `createdAt`, `updatedAt`
- **ProductionSegment**: Производственные участки
  - `id`, `name`, `lineId`, `bufferId`, `createdAt`, `updatedAt`

### Фиксируемые данные
- Создание производственных линий с указанием типа (основная, второстепенная)
- Формирование участков в составе линий
- Привязка буферов к линиям и участкам
- Привязка станков к участкам (через связь в Machine)

## Фиксация данных на разных этапах

### 1. Этап планирования производства
**Фиксируемые данные:**
- Создание производственного заказа (ProductionOrder)
- Формирование УПАКов в составе заказа (ProductionYpak)
- Определение деталей и их количества в УПАКах (ProductionYpakDetail)
- Назначение маршрутов обработки для деталей (ProductionDetail → ProductionRoute)

### 2. Этап подготовки производства
**Фиксируемые данные:**
- Размещение деталей на поддонах (ProductionPallets)
- Установка статуса заказа "разрешен к запуску" (ProductionOrder.allowedToRun)
- Проверка доступности станков (Machine.status)
- Проверка доступности буферных ячеек (BufferCell.status)

### 3. Этап запуска производства
**Фиксируемые данные:**
- Создание операции обработки (DetailOperation)
- Фиксация начала операции (DetailOperation.startedAt)
- Назначение оператора и мастера (DetailOperation.operatorId, DetailOperation.masterId)
- Выбор станка для операции (DetailOperation.machineId)

### 4. Этап выполнения операции
**Фиксируемые данные:**
- Обновление статуса операции (DetailOperation.status = IN_PROGRESS)
- Обновление статуса станка (Machine.status = ACTIVE)
- Обновление прогресса выполнения УПАКа и заказа (ProductionYpak.progress, ProductionOrder.progress)

### 5. Этап перемещения в буфер
**Фиксируемые данные:**
- Изменение статуса операции (DetailOperation.status = BUFFERED)
- Назначение поддону ячейки буфера (ProductionPallets.bufferCellId)
- Обновление статуса ячейки буфера (BufferCell.status = OCCUPIED)

### 6. Этап завершения операции
**Фиксируемые данные:**
- Фиксация завершения операции (DetailOperation.completedAt, DetailOperation.status = COMPLETED)
- Освобождение станка (обновление Machine.status)
- Обновление прогресса выполнения УПАКа и заказа

### 7. Этап завершения заказа
**Фиксируемые данные:**
- Установка статуса заказа "завершен" (ProductionOrder.completed = true)
- Фиксация даты завершения заказа (ProductionOrder.finishedAt)
- Установка прогресса выполнения заказа в 100% (ProductionOrder.progress = 100)

### 8. Этап авторизации и аудита
**Фиксируемые данные:**
- Регистрация входов пользователей в систему (LoginLog)
- Фиксация IP-адреса и устройства (LoginLog.ip, LoginLog.userAgent)
- Отслеживание успешности входа (LoginLog.success)
