
# Документация API станка упаковки

## Получение сменного задания для станка упаковки

### Эндпоинт

```
GET /ypak/machines/:machineId/task
```

где `:machineId` - идентификатор станка.

### Описание

Данный эндпоинт возвращает список задач для станка упаковки, включая информацию о заказах, упаковках, количестве деталей и статусах операций.

### Структура ответа

Ответ представляет собой JSON-объект со следующей структурой:

```typescript
{
  machineId: number;      // ID станка
  machineName: string;    // Название станка упаковки
  tasks: TaskItem[];      // Массив задач для выполнения
}
```

Где `TaskItem` имеет следующую структуру:

```typescript
{
  operationId: number;       // ID операции
  processStepId: number;     // ID этапа обработки
  processStepName: string;   // Название этапа обработки (обычно "Упаковка")
  priority: number | null;   // Приоритет задания (null, если не задан)
  quantity: number;          // Количество для упаковки
  status: OperationStatus;   // Статус операции (ON_MACHINE, IN_PROGRESS, COMPLETED, BUFFERED)
  totalQuantity: number;     // Общее количество деталей в упаковке
  readyForPackaging: number; // Количество деталей, готовых к упаковке
  packaged: number;          // Количество уже упакованных деталей
  
  // Информация о упаковке
  ypak: {
    id: number;             // ID упаковки
    article: string | null; // Артикул упаковки (может быть null)
    name: string;           // Название упаковки
  },
  
  // Информация о заказе
  order: {
    id: number;            // ID заказа
    runNumber: string;     // Номер партии
    name: string;          // Название заказа
    progress: number | null; // Процент выполнения заказа (может быть null)
  }
}
```

### Статусы операций (`OperationStatus`)

- `ON_MACHINE` - Поддон записан в задание для станка, но еще не обрабатывается
- `IN_PROGRESS` - Операция выполняется в данный момент
- `COMPLETED` - Операция завершена
- `BUFFERED` - Операция приостановлена, поддон помещен в буфер

### Пример ответа

```json
{
  "machineId": 5,
  "machineName": "Станок упаковки №1",
  "tasks": [
    {
      "operationId": 123,
      "processStepId": 8,
      "processStepName": "Упаковка",
      "priority": 1,
      "quantity": 25,
      "status": "ON_MACHINE",
      "totalQuantity": 50,
      "readyForPackaging": 40,
      "packaged": 30,
      "ypak": {
        "id": 42,
        "article": "УПАК-1234",
        "name": "Комплект для стола ученического"
      },
      "order": {
        "id": 15,
        "runNumber": "РП-123456",
        "name": "Заказ мебели для школы №5",
        "progress": 65.5
      }
    },
    {
      "operationId": 124,
      "processStepId": 8,
      "processStepName": "Упаковка",
      "priority": 2,
      "quantity": 10,
      "status": "IN_PROGRESS",
      "totalQuantity": 30,
      "readyForPackaging": 24,
      "packaged": 18,
      "ypak": {
        "id": 43,
        "article": "УПАК-5678",
        "name": "Комплект для шкафа"
      },
      "order": {
        "id": 15,
        "runNumber": "РП-123456",
        "name": "Заказ мебели для школы №5",
        "progress": 65.5
      }
    }
  ]
}
```

## Рекомендации по использованию

### Отображение задач

Задачи (`tasks`) отсортированы по приоритету, поэтому рекомендуется отображать их в том порядке, в котором они приходят с сервера.

### Статус выполнения

Для отображения прогресса выполнения задачи можно использовать следующие поля:
- `totalQuantity` - общее количество деталей (100%)
- `readyForPackaging` - количество деталей, готовых к упаковке
- `packaged` - количество уже упакованных деталей

Процент выполнения можно рассчитать как `(packaged / totalQuantity) * 100`.

### Визуальное оформление

Рекомендуется визуально выделять активные задачи (со статусом `IN_PROGRESS`) для привлечения внимания оператора.

### Обновление данных

Рекомендуется настроить периодическое обновление данных (polling) с частотой примерно раз в 30 секунд для получения актуальной информации о задачах.

## Примечания

В текущей реализации значения полей `readyForPackaging` и `packaged` являются временными заглушками:
- `readyForPackaging` составляет 80% от `totalQuantity`
- `packaged` составляет 60% от `totalQuantity`

В дальнейшем эти значения будут рассчитываться на основе реальных данных из системы.
